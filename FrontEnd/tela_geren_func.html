<html>
<header>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="layout.css">
</header>
<head>

</head>
<body>
	<div class="container">
		<div class="row" style="height: 90%">
			<div class="col s12" style="background-color: #000055">
				<p style="color: white; text-align: center; height: 25px">Funcionarios</p>
				<a href="tela_geren_func.html" target="_self" style="border:10px solid #e6e6e6; background-color:#e6e6e6;text-align:center; color:black">VOLTAR</a>
			</div>
			<div id="sucesso" class="col s6" style="background-color: white;height: 95%;overflow-y: scroll;">
				<!-- bloco dos funcionarios  -->
			</div>

			<div class="col s6" id="formTelaFunc" style="background-color: darkgray;height: 95%"/>
				<button class="open-button" onclick="openForm()">Cadastrar Funcionário</button>
			    <div class="form-popup" id="myForm">
			        <form name="myForm" id="myForm" method="post" onsubmit="return validar()" class="form-container">
			            <h1 style="text-align: center; font-size:20px;" >Cadastrar funcionario  </h1>

						<input id="funcName" type="text" placeholder="Nome do funcionario"/>			            
			            <input id="funcCpf" type="text" maxlength="14" OnKeyPress="formatar('###.###.###-##', this)" placeholder="CPF"/>
			            <input id="funcTel" type="text" maxlength="13" OnKeyPress="formatar('##-#####-####', this)" placeholder="Celular"/>
			            <input id="funcEmail" type="text" placeholder="E-mail"/>
			            <input id="funcEnd" type="text" placeholder="Endereço"/>
			            <input id="funcPass" type="password" placeholder="Senha"/>
			            <input id="funcPass2" type="password" placeholder="Confirmar senha"/>

			            <button type="submit" class="btn" style="text-align:center;">Cadastrar</button>
			            <button type="button" class="btn cancel" onclick="closeForm()" style="text-align:center;">Fechar</button>
			        </form>
			    </div>
			</div>
		</div>
	</div>

	<div class="container col s6" style="background-color: #000055; height: 55px; padding: 1px;">
		<div class="container" style="text-align: center;">
        <p style="color: white">
        	 © 2018 Desenvolvido por alunos da FATEC-SP
        </p>	
        </div>
    </div>
</body>

<script>
    function removeCE(value)
    {
        var listaParaRemover = ['.',',','/','\\','-'];

        for(var item in listaParaRemover)
        {
            var location = value.indexOf(listaParaRemover[item]);
            while(location > -1)
            {
                value = value.replace(listaParaRemover[item], "");
                location = value.indexOf(listaParaRemover[item]);
            }
        }

        return value;
    }

    function formatar(mascara, documento) {
        var i = documento.value.length;
        var saida = mascara.substring(0, 1);
        var texto = mascara.substring(i)

        if (texto.substring(0, 1) != saida) {
            documento.value += texto.substring(0, 1);
        }
    }

    function validar() {
		if(document.myForm.funcName.value=="" || document.myForm.funcName.value.length < 5){
			alert( "Preencha campo NOME corretamente!" );
			document.myForm.funcName.focus();
			return false;
		}
		if(document.myForm.funcCpf.value=="" || document.myForm.funcCpf.value.length < 11){
			alert( "Preencha campo CPF corretamente!" );
			document.myForm.funcCpf.focus();
			return false;
		}
		if(document.myForm.funcTel.value=="" || document.myForm.funcTel.value.length < 11){
			alert( "Preencha campo CELULAR corretamente!" );
			document.myForm.funcTel.focus();
			return false;
		}
		if(document.myForm.funcEmail.value=="" || document.myForm.funcEmail.value.indexOf('@')==-1 || document.myForm.funcEmail.value.indexOf('.')==-1){
			alert( "Preencha campo EMAIL corretamente!" );
			document.myForm.funcEmail.focus();
			return false;
		}
		if(document.myForm.funcEnd.value=="" || document.myForm.funcEnd.value.length < 4){
			alert( "Preencha campo ENDEREÇO corretamente!" );
			document.myForm.funcEnd.focus();
			return false;
		}
		if(document.myForm.funcPass.value != document.myForm.funcPass2.value || document.myForm.funcPass.value=="" || document.myForm.funcPass2.value=="" ){ 
             alert("SENHAS DIFERENTES! DIGITAR SENHAS IGUAIS");
             return false;
        }
		else{
		return registraFuncionario();
		}
    }

    function openForm() {
        document.getElementById("myForm").style.display = "block";
    }

    function closeForm() {
        document.getElementById("myForm").style.display = "none";
    }

    function registraFuncionario() {
        var funcName = document.getElementById("funcName").value;
        var funcCpf = removeCE(document.getElementById("funcCpf").value);
        var funcTel = removeCE(document.getElementById("funcTel").value);
        var funcEmail = document.getElementById("funcEmail").value;
        var funcEnd = document.getElementById("funcEnd").value;
        var funcPass = document.getElementById("funcPass").value;

        var func = {
            Cpf: funcCpf,
            Nome: funcName,
            TelCel: funcTel,
            Email: funcEmail,
            End: funcEnd
        }

        $.ajax({
            url: 'http://localhost:8081/api/funcionario',
            type: 'post',
            dataType: 'text',
            contentType: 'application/json',
            success: function (data) {
                alert("Funcionario registrado");
                closeForm();
                document.location.reload(true);
            },
            data: JSON.stringify(func)
        });
    
        return false;
    };
	
		function getFuncionario() {

		var funcionario = [];

        $.getJSON("http://localhost:8081/api/funcionario", function(data){

        	$.each(data, function(i, object){
        		funcionario.push({
        				Nome: object.Nome,
    					Cpf: object.Cpf,
					    TelCel: object.TelCel,
					    Email: object.Email,
					    End: object.End
    			});
        	});

            document.getElementById("sucesso").innerHTML = "";
			for (var i = 0; i < funcionario.length; i++ ) {
			    document.getElementById("sucesso").innerHTML += 
						    '<div class="card-content-black-text">' + 
							    '<span class="card-title"><span class="step">Nome: ' + funcionario[i].Nome + '</span></span>' +
						    	'<div class="block-with-text"><b>CPF: </b>'+ funcionario[i].Cpf + '</div>' +
								'<div class="block-with-text"><b>Celular:</b> ' + funcionario[i].TelCel + '</div>'+
								'<div class="block-with-text"><b>E-mail: </b>'+ funcionario[i].Email + '</div>'+
								'<button id="removerDiv" type="button" onclick="return deleteFuncionario('+ funcionario[i].Cpf +')" >Deletar</button>'+
							 '</div>';
			}
		})
    };

    function deleteFuncionario(cpf)
    {

        $.ajax({
            url: 'http://localhost:8081/api/funcionario/'+cpf,
            type: 'delete',
            success: function (result) {
                alert("Funcionario deletado!");
                closeForm();
                getFuncionario();
            }
        });
    };

</script>
<script>getFuncionario();</script>
</html>
