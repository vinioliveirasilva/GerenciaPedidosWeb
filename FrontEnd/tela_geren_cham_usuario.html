<html>
	<header>
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	    <script type="text/javascript">
	    	var chamados = [];
			var StatusColor = Object.freeze({0:"gray" ,1:"red", 2:"blue", 3:"green", 4:"#BF9000"}); //Cores do status dos chamados
			var StatusText = Object.freeze({0:"Indeterminado" ,1:"Em aberto", 2:"Em progresso", 3:"Concluido", 4:"Interrompido"});
			var PrioridadeColor = Object.freeze({0:"gray", 1:"green", 2:"red"});
			var PrioridadeText = Object.freeze({0:"baixa", 1:"media", 2:"alta"});
	    </script>>
	<style type="text/css">
		div.status {
		    position: absolute;
		    top: -25px;
		    width: 100%;
		    color: white;
		    text-align: center;
		}

		div.prioridade {
			position: absolute;
		    top: 148px;
		    width: 100%;
		    color: white;
		    text-align: center;
		    font-size: 15;
		}

		div.card {
			background-color:white;
			border-style: solid;
			border-width: 30px 3px 20px 3px; 
			height: 200px;
		}

		span.step {
			background: #595959;
			border-radius: 0.4em;
			-moz-border-radius: 0.4em;
			-webkit-border-radius: 0.4em;
			color: #ffffff;
			display: inline-block;
			line-height: 2em;
			margin-right: 5px;
			text-align: center;
			width: 5em; 
			font-size: 20;
		}

				/* styles for '...' */ 
		.block-with-text {
		  /* hide text if it more than N lines  */
		  overflow: hidden;
		  /* for set '...' in absolute position */
		  position: relative; 
		  /* use this value to count block height */
		  line-height: 1.2em;
		  /* max-height = line-height (1.2) * lines max number (3) */
		  max-height: 4.8em; 
		  /* fix problem when last visible word doesn't adjoin right side  */
		  text-align: justify;  
		  /* place for '...' */
		  margin-right: -1em;
		  padding-right: 1em;
		}
		/* create the ... */
		.block-with-text:before {
		  /* points in the end */
		  content: '...';
		  /* absolute position */
		  position: absolute;
		  /* set position to right bottom corner of block */
		  right: 0;
		  bottom: 0;
		}
		/* hide ... if we have text, which is less than or equal to max lines */
		.block-with-text:after {
		  /* points in the end */
		  content: '';
		  /* absolute position */
		  position: absolute;
		  /* set position to right bottom corner of text */
		  right: 0;
		  /* set width and height */
		  width: 1em;
		  height: 1em;
		  margin-top: 0.2em;
		  /* bg color = bg color under block */
		  background: white;
		}

	</style>
	</header>
	<head>
		
	</head>
	<body>
		<div class="container">
			<div class="row" style="height: 90%">
				<div class="col s12" style="background-color: #000055">
					<p style="color: white; text-align: center; height: 25px">Chamados</p>
					<a href="tela_geren_func.html" target="_self" style="border:10px solid #e6e6e6; background-color:#e6e6e6;text-align:center; color:black">VOLTAR</a>
				</div>

				<div class="col s6" style="background-color: white;height: 95%;overflow-y: scroll;">
					<div id="myBtnContainer" style="outline: 3px; outline-color: blue; outline-style: solid; padding: 10px; margin-top: 10px;">
					  <button class="btn active" style="width: 100%; margin-bottom: 10px; margin-top: 10px" onclick="resetFilter()">Mostrar todos</button>
					  <select class="filtroStatus" style="display: inline-flex;margin-bottom: 10px;" onchange="filterSelection()">
						<option value="-1">Selecione o status</option>
					  	<option value="1">Em Aberto</option>
					  	<option value="2">Em Progresso</option>
					  	<option value="3">Concluido</option>
					    <option value="0">Indeterminado</option>
					</select>
					  <select class="filtroPrioridade" style="display: inline-flex;margin-bottom: 10px;" onchange="filterSelection()">
						<option value="-1">Selecione a prioridade</option>
					  	<option value="0">Baixa</option>
					  	<option value="1">Media</option>
					  	<option value="2">Alta</option>
					</select>
					<div class="busca">
						<input id="filtro" onkeyup="filterSelection()" type="text" placeholder="Buscar texto...">
					</div>
					</div>
						
					<div id="sucesso"><!-- bloco dos chamados  --></div>
				</div>

				<div class="col s6"style="background-color: darkgray;height: 95%"/>
				</div>
			</div>
		</div>

		<div class="container col s6" style="background-color: #000055; height: 55px; padding: 1px;">
			<div class="container" style="text-align: center;">
            <p style="color: white">
            	 Â© 2018 Desenvolvido por alunos da FATEC-SP
            </p>	
            </div>
        </div>
	</body>
	<script>

	function filterSelection()
	{
		var filter, i;
		p = document.getElementsByClassName("filtroPrioridade");
		s = document.getElementsByClassName("filtroStatus");

        filter = document.getElementById("filtro").value.toUpperCase();
        Prioridade = p.item(p.selectedIndex).value;
        Status = s.item(s.selectedIndex).value;

        for (i = 0; i < chamados.length; i++) {
            if ((chamados[i].Status == Status || Status == -1) && (chamados[i].Prioridade == Prioridade || Prioridade == -1) && (chamados[i].Titulo.toUpperCase().indexOf(filter) > -1 || chamados[i].Problema.toUpperCase().indexOf(filter) > -1)) {
                chamados[i].Show = true;
            } 
            else {
                chamados[i].Show = false;
            }
        }
        atualizaChamados();
	}

	function resetFilter()
	{
		for (i = 0; i < chamados.length; i++)
			chamados[i].Show = true;

		atualizaChamados();
	}

	function getChamados() {

		chamados = [];

        $.getJSON("http://localhost:8081/api/chamado", function(data){

        	$.each(data, function(i, object){
        		chamados.push({
        				Id: object.Id,
    					Titulo: object.Titulo,
					    Problema: object.Problema,
					    Status: object.Status,
					    Prioridade: object.Prioridade,
					    Data_Abertura: object.Data_Abertura,
					    Data_Fechamento: object.Data_Fechamento,
					    Show: true
    			});
        	});

        	chamados.sort(function(a, b) { 
			    return a.Id - b.Id;
			})

			atualizaChamados();
		})
    };

    function atualizaChamados()
    {
    	document.getElementById("sucesso").innerHTML = "";

    	for (var i = 0; i < chamados.length; i++ ) {
			if(chamados[i].Show == true)
			    document.getElementById("sucesso").innerHTML += 
			    		'<div class="card" style="border-color:'+ StatusColor[chamados[i].Status] +';"> '+
			    		'<div class="status"><b>' + StatusText[chamados[i].Status] + '</b></div>'  + 
			    		'<div class="prioridade">prioridade ' + PrioridadeText[chamados[i].Prioridade] + '</div>' +
						    '<div class="card-content black-text">' + 
							    '<span class="card-title"> <span class="step">ID - ' + chamados[i].Id + '</span>  <b>Cliente: '+ chamados[i].Titulo + '</b></span> '+
						    	'<div class="block-with-text"><b> Problema:</b> ' + chamados[i].Problema +'</div>' + 
							    '</div>'+
						    '</div>';
			}
    };
	</script>
<script>getChamados();</script>
</html>