<html>
	<header>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	    <script type="text/javascript">
	    	var chamados = [];
			var StatusColor = Object.freeze({0:"gray" ,1:"red", 2:"blue", 3:"green", 4:"#BF9000"}); //Cores do status dos chamados
			var StatusText = Object.freeze({0:"Indeterminado" ,1:"Em aberto", 2:"Em progresso", 3:"Concluido", 4:"Interrompido"});
			var PrioridadeColor = Object.freeze({0:"gray", 1:"green", 2:"red"});
			var PrioridadeText = Object.freeze({0:"baixa", 1:"media", 2:"alta"});
	    </script>>
	<style type="text/css">
    div.prioridade {
      position: absolute;
        top: 148px;
        width: 100%;
        color: white;
        text-align: center;
        font-size: 15;
    }
        div.status {
        position: absolute;
        top: -25px;
        width: 100%;
        color: white;
        text-align: center;
    }
.leave-button {
      position:absolute;
      top: 2px; 
            background-color: #555;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
      float: right;
            opacity: 0.8;
            right: 77%;
            width: 120;
            top: 25px;
        }

        .empr-button {
            right: 16.7%;
            width: 120;
            top: 25px;
        }

        .func-button {
            right: 23.5%;
            width: 120;
            top: 25px;
        }

		div.card {
			background-color:white;
			border-style: solid;
			border-width: 30px 3px 20px 3px; 
			height: 200px;
		}

		span.step {
			background: #595959;
			border-radius: 0.4em;
			-moz-border-radius: 0.4em;
			-webkit-border-radius: 0.4em;
			color: #ffffff;
			display: inline-block;
			line-height: 2em;
			margin-right: 5px;
			text-align: center;
			width: 5em; 
			font-size: 20;
		}

				/* styles for '...' */ 
		.block-with-text {
		  /* hide text if it more than N lines  */
		  overflow: hidden;
		  /* for set '...' in absolute position */
		  position: relative; 
		  /* use this value to count block height */
		  line-height: 1.2em;
		  /* max-height = line-height (1.2) * lines max number (3) */
		  max-height: 4.8em; 
		  /* fix problem when last visible word doesn't adjoin right side  */
		  text-align: justify;  
		  /* place for '...' */
		  margin-right: -1em;
		  padding-right: 1em;
		}
		/* create the ... */
		.block-with-text:before {
		  /* points in the end */
		  content: '...';
		  /* absolute position */
		  position: absolute;
		  /* set position to right bottom corner of block */
		  right: 0;
		  bottom: 0;
		}
		/* hide ... if we have text, which is less than or equal to max lines */
		.block-with-text:after {
		  /* points in the end */
		  content: '';
		  /* absolute position */
		  position: absolute;
		  /* set position to right bottom corner of text */
		  right: 0;
		  /* set width and height */
		  width: 1em;
		  height: 1em;
		  margin-top: 0.2em;
		  /* bg color = bg color under block */
		  background: white;
		}

	</style>
	</header>
	<body>
		<div class="container">
			<div class="row">
				<div class="col s12" style="background-color: #000055">
					<p style="color: white; text-align: center; height: 25px">Chamados</p>
				</div>
				<div class="col s6" style="background-color: white;height: 95%;overflow-y: scroll;">
					<div id="myBtnContainer" style="outline: 3px; outline-color: blue; outline-style: solid; padding: 10px; margin-top: 10px;">
					  <button class="btn active" style="width: 100%; margin-bottom: 10px; margin-top: 10px" onclick="resetFilter()">Mostrar todos</button>
					  <select class="filtroStatus" style="display: inline-flex;margin-bottom: 10px;" onchange="filterSelection()">
						<option value="-1">Selecione o status</option>
					  	<option value="1">Em Aberto</option>
					  	<option value="2">Em Progresso</option>
					  	<option value="3">Concluido</option>
					    <option value="0">Indeterminado</option>
					</select>
					  <select class="filtroPrioridade" style="display: inline-flex;margin-bottom: 10px;" onchange="filterSelection()">
						<option value="-1">Selecione a prioridade</option>
					  	<option value="0">Baixa</option>
					  	<option value="1">Media</option>
					  	<option value="2">Alta</option>
					</select>
					<div class="busca">
						<input id="filtro" onkeyup="filterSelection()" type="text" placeholder="Buscar texto...">
					</div>
					</div>
						
					<div id="sucesso"><!-- bloco dos chamados  --></div>
				</div>

				<div class="col s6"style="background-color: darkgray;height: 95%"/>
				<button class="leave-button" onclick="Logout()">Sair</button>
				<button class="leave-button func-button" onclick="window.location.href = './tela_geren_func.html';">Funcionarios</button>
				<button class="leave-button empr-button" onclick="window.location.href = './tela_geren_empresa.html';">Empresas</button>
				<div style="margin: 20px; background-color: white">
					<div class="row" style="padding: 40px">
						<div class="col s5">
							<div class="row">
								<span class="step" style="width: 100%">ID - 128</span>
							</div>
							<div class="row">
								<h5>Titulo - Problema no servidor</h5>
							</div>
							<div class="row">
								<div>Status:<b> Em Progresso </b></div>
							</div>
							<div class="row">
								<div>Prioridade:<b> Em Progresso </b></div>
							</div>

						</div>
						<div class="col s7" style="padding-left: 40px">
							<div class="row">
								<div><h5>Cliente:<b> Google</b></h5></div>
							</div>
							<div class="row">
								<div>Endereço:<b> Av. Brasil, 57 - Bairro X</b></div>
							</div>
							<div class="row">
								<div>Cnpj:<b> 62.478.776/0001-79</b></div>
							</div>
							<div class="row">
								<div>Telefone:<b> (11) 98765-4321</b></div>
							</div>
							<div class="row">
								<div>Email:<b> Email@cliente.com</b></div>
							</div>
							<div class="row">
								<div>Data Abertura:<b> 27/11/2018</b></div>
							</div>
						</div>
						<div class="col 12s" >
								<div>Responsavel:<b> Tecnico Fulano de Tal (Não definido)</b></div><br><br>

								<div><b>Problema:</b> Vamos supor que, em determinado dia, o sistema não funcione na fábrica. A paralisação do serviço é um incidente e deve ser tratado com o máximo de urgência. Imediatamente, descobre-se que não está havendo tráfego no link principal.

A solução de contorno é comutar para a rota alternativa. Isso feito, o sistema é restabelecido e as operações são reparadas. Mas a grande questão é: o que causou o incidente? Qual o motivo de aquele link não estar respondendo? Qual foi o problema?</div><br><br>
								<div><b>Diagnostico:</b> A tecnologia faz parte da rotina de sua empresa? É bem provável que você tenha respondido “sim” a essa pergunta, afinal, é praticamente impossível encontrar uma empresa que não utilize qualquer solução tecnológica em sua rotina.

E isso nos leva a outra pergunta: você sabe o que é diagnóstico de TI e porque essa avaliação pode ser de suma importância para o sucesso de seu empreendimento? Se você respondeu que “não”, tudo bem. Explicamos tudo neste post.

Desde já, vale saber que esse diagnóstico de tecnologia, além de contribuir para a redução de riscos, contribui para o aumento da segurança e da produtividade e, ainda, para a melhoria do desempenho da empresa. Continue a leitura para saber mais!</div>
						</div>


					</div>
				</div>
				</div>
			</div>
		</div>

		<div class="container col s6" style="background-color: #000055; height: 55px; padding: 1px;">
			<div class="container" style="text-align: center;">
            <p style="color: white">
            	 © 2018 Desenvolvido por alunos da FATEC-SP
            </p>	
            </div>
        </div>
	</body>
	<script>

	function filterSelection()
	{
		var filter, i;
		p = document.getElementsByClassName("filtroPrioridade");
		s = document.getElementsByClassName("filtroStatus");

        filter = document.getElementById("filtro").value.toUpperCase();
        Prioridade = p.item(p.selectedIndex).value;
        Status = s.item(s.selectedIndex).value;

        for (i = 0; i < chamados.length; i++) {
            if ((chamados[i].Status == Status || Status == -1) && (chamados[i].Prioridade == Prioridade || Prioridade == -1) && (chamados[i].Titulo.toUpperCase().indexOf(filter) > -1 || chamados[i].Problema.toUpperCase().indexOf(filter) > -1)) {
                chamados[i].Show = true;
            } 
            else {
                chamados[i].Show = false;
            }
        }
        atualizaChamados();
	}

	function resetFilter()
	{
		for (i = 0; i < chamados.length; i++)
			chamados[i].Show = true;

		atualizaChamados();
	}

	function getChamados() {

		chamados = [];

        $.getJSON("http://apiengsoft.ddns.net:8081/api/chamado", function(data){

        	$.each(data, function(i, object){
        		chamados.push({
        				Id: object.Id,
    					Titulo: object.Titulo,
					    Problema: object.Problema,
					    Status: object.Status,
					    Prioridade: object.Prioridade,
					    Data_Abertura: object.Data_Abertura,
					    Data_Fechamento: object.Data_Fechamento,
					    Show: true
    			});
        	});

        	chamados.sort(function(a, b) { 
			    return a.Id - b.Id;
			})

			atualizaChamados();
		})
    };

    function atualizaChamados()
    {
    	document.getElementById("sucesso").innerHTML = "";

    	for (var i = 0; i < chamados.length; i++ ) {
			if(chamados[i].Show == true)
			    document.getElementById("sucesso").innerHTML += 
			    		'<div class="card" style="border-color:'+ StatusColor[chamados[i].Status] +';"> '+
			    		'<div class="status"><b>' + StatusText[chamados[i].Status] + '</b></div>'  + 
			    		'<div class="prioridade">prioridade ' + PrioridadeText[chamados[i].Prioridade] + '</div>' +
						    '<div class="card-content black-text">' + 
							    '<span class="card-title"> <span class="step">ID - ' + chamados[i].Id + '</span>  <b>Cliente: '+ chamados[i].Titulo + '</b></span> '+
						    	'<div class="block-with-text"><b> Problema:</b> ' + chamados[i].Problema +'</div>' + 
							    '</div>'+
						    '</div>';
			}
    };

    function getCookie(cname) {
	    var name = cname + "=";
	    var decodedCookie = decodeURIComponent(document.cookie);
	    var ca = decodedCookie.split(';');
	    for(var i = 0; i <ca.length; i++) {
	        var c = ca[i];
	        while (c.charAt(0) == ' ') {
	            c = c.substring(1);
	        }
	        if (c.indexOf(name) == 0) {
	            return c.substring(name.length, c.length);
	        }
		}
    	return "";
	};

	    function Logout()
    {
        setCookie("User", "", 20);
          setCookie("Type", -1, 20);
          setCookie("Autorized", "false", 20);
          setCookie("Rank", -1, 20);
        window.location.replace('./index.html');
    }

    function setCookie(cname,cvalue,exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*60*1000));
    var expires = "expires=" + d.toGMTString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ",path=/";
}

	if(getCookie("Autorized") == "" || getCookie("Type") != 1)
	{
		alert("Você não tem acesso a essa area, contate o administrador");
		window.location.replace('./index.html');
	}
	</script>

<script>getChamados();</script>
</html>